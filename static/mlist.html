<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title> 搜索结果页 - 视频搜索 </title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="Author" content="xiewulong" />
<meta name="Keywords" content="" />
<meta name="Description" content="" />
<link rel="stylesheet" type="text/css" href="css/public.css" />
<link rel="stylesheet" type="text/css" href="css/main.css" />
<script type="text/javascript" src="js/jquery-1.8.3.min.js"></script>
<script type="text/javascript" src="js/jquery.tinyscrollbar.min.js"></script>
<!--[if IE 6]>
<script src="js/DD_belatedPNG.js"></script>
<script src="js/png.js"></script>
<![endif]-->
</head>

<body>

<div id="scrollbar" class="scrollbar">

<div id="wdj_xwl_search" class="wdj_xwl_search fix">
	<div class="wdj_xwl_search_btn"><a href="#" id="wdj_xwl_search_btn"></a></div>
	<div class="wdj_xwl_search_ipt"><span><form method="get" action="list.html" id="searchform"><input type="text" id="wdj_xwl_search_ipt" class="wdj_xwl_inputs" name="word" /></form></span></div>
</div>

<div class="w760 mrla">

	<div id="wdj_xwl_type" class="wdj_xwl_type">
		<a href="?list=mhot">全部</a>
		<em>·</em>
		<a href="?cate=m_zhuanji">传记</a>
		<em>·</em>
		<a href="?cate=m_lunli">伦理</a>
		<em>·</em>
		<a href="?cate=m_juqing">剧情</a>
		<em>·</em>
		<a href="?cate=m_dongzuo">动作</a>
		<em>·</em>
		<a href="?cate=m_lishi">历史</a>
		<em>·</em>
		<a href="?cate=m_donghua">动画</a>
		<em>·</em>
		<a href="?cate=m_xiju">喜剧片</a>
		<em>·</em>
		<a href="?cate=m_kongbu">恐怖</a>
		<em>·</em>
		<a href="?cate=m_xuanyi">悬疑</a>
		<em>·</em>
		<a href="?cate=m_jingsong">惊悚</a>
		<em>·</em>
		<a href="?cate=m_zhanzheng">战争</a>
		<em>·</em>
		<a href="?cate=m_wuxia">武侠</a>
		<em>·</em>
		<a href="?cate=m_kehuan">科幻</a>
		<em>·</em>
		<a href="?cate=m_gewu">歌舞</a>
		<em>·</em>
		<a href="?cate=m_aiqing">爱情</a>
		<em>·</em>
		<a href="?cate=m_duan">短片</a>
		<em>·</em>
		<a href="?cate=m_jilu">记录</a>
        <br>
		<!--<em>·</em>-->
        <div style="margin-top:5px">
		<a href="?cate=m_zainan">灾难</a>
		<em>·</em>
		<a href="?cate=m_jingfei">警匪</a>
		<em>·</em>
		<a href="?cate=m_fengyue">风月</a>
		<em>·</em>
		<a href="?cate=m_mohuan">魔幻</a>
		<em>·</em>
		<a href="?cate=m_qingchun">青春</a>
		<em>·</em>
		<a href="?cate=m_wenyi">文艺</a>
		<em>·</em>
		<a href="?cate=m_diezhan">谍战</a>
    </div>
	</div>

	<div class="wdj_xwl_wrap_search">

		<div class="wdj_xwl_box">
			<div class="wdj_xwl_box_title wdj_xwl_box_title_nb wdj_xwl_box_title_pl8 wdj_xwl_box_title1"><h3 id="vtype"></h3></div>
			<div class="wdj_xwl_box_con">
				<div id="vlist" class="wdj_xwl_sreachlist"></div>
			</div>
		</div>

		<div id="wdj_xwl_pages" class="wdj_xwl_pages"></div>

	</div>

	<div class="footer" style="border-top:1px solid #CCC;font-size:12px;margin:30px 0 20px;">
		<p style="color:#666;margin:10px">&copy; 2010 - 2013 豌豆实验室 </p>
	 <p style="color:#999;margin-left:10px;">除非特别注明，视频资源由第三方视频服务商提供，豌豆荚仅根据您的指令提供搜索结果链接，与出处无关，详情请参阅<a class="link" target="_default" href="http://www.wandoujia.com/intellectual_property">知识产权保护声明</a></p> 
	</div>

</div>

</div>

<script type="text/javascript" src="js/main.js"></script>
<script type="text/javascript">
(function(){
	var url=location.href;
	if(url.indexOf('?')==-1){
		getVideo('http://video.wandoujia.com/api/tv/hot?page=1&size=10&jsonp=?');
		$('#vtype').html('电视剧');
		$('#wdj_xwl_type a').eq(0).addClass('on');
		return false;
	}
	var url=url.substring(url.indexOf('?')+1).split('&');
	var actions={};
	for(var i=0;i<url.length;i++){
		if(url[i].indexOf('=')!=-1){
			var index=url[i].indexOf('=');
			actions[url[i].substring(0,index)]=url[i].substring(index+1);
		}
	}

	var size=10;
	var page=actions.page?actions.page:1;
	var host='http://video.wandoujia.com/api/';
	var action='?jsonp=?&page='+page+'&size='+size;
	var tag=0;

	if(actions.word){
		host+='s';
		action+='&word='+actions.word;
		var sword=decodeURIComponent(actions.word)
		$('#vtype').html(sword);
		$('#wdj_xwl_search_ipt').val(sword).focus();
	}else if(actions.cate){
		host+='s';
		action+='&cate='+actions.cate;
		var cates={
            "m_zhuanji":   "传记", 
            "m_lunli":     "伦理",
            "m_juqing":    "剧情",
            "m_dongzuo":   "动作",
            "m_donghua":   "动画",
            "m_lishi":     "历史",
            "m_xiju":      "喜剧片",
            "m_kongbu":    "恐怖",
            "m_xuanyi":    "悬疑",
            "m_jingsong":  "惊悚",
            "m_zhanzheng": "战争",
            "m_gewu":      "歌舞",
            "m_wuxia":     "武侠",
            "m_zainan":    "灾难",
            "m_aiqing":    "爱情",
            "m_duan":      "短片",
            "m_kehuan":    "科幻",
            "m_jilu":      "记录",
            "m_jingfei":   "警匪",
            "m_fengyue":   "风月",
            "m_mohuan":    "魔幻",
            "m_qingchun":  "青春",
            "m_wenyi":     "文艺",
            "m_diezhan":   "谍战"
		}
		$('#vtype').html(cates[actions.cate]);
		$('#wdj_xwl_type a').each(function(){if($(this).text()==cates[actions.cate])$(this).addClass('on');});
	}else{
		tag=1;
		switch(actions.list){
			case 'thot':
				host+='tv/hot';
				$('#vtype').html('电视剧');
				$('#wdj_xwl_type a').eq(0).addClass('on');
				break;
			case 'tnew':
				host+='tv/new';
				$('#vtype').html('电视剧');
				break;
			case 'mhot':
				host+='movie/hot';
				$('#vtype').html('电影');
				break;
			case 'mnew':
				host+='movie/new';
				$('#vtype').html('电影');
				break;
		}
	}
	var url=host+action;
	//alert(url);

	if(tag)getVideo(url);
	else getVideo2(url);

	function getVideo(url){
		$.getJSON(url,function(d){
			var vs=d.items;
			if(vs.length==0){
				$('#wdj_xwl_pages').hide();
				$('.wdj_xwl_wrap_search').css('height','auto').css('minHeight','0');
				$('#vlist').html('<div class="noquery">未到找与「<span>'+$('#vtype').text()+'</span>」匹配的视频</div>');
				return false;
			}
			for(var i in vs){
				var href1='show.html?'+vs[i].id+'"';
				if(vs[i].type=='tv'){
					var href2=href1;
					var btntxt='查看详情';
				}else{
					var href2='http://video.wandoujia.com/api/down/'+vs[i].id+'#&name='+vs[i].title+'.mp4&content-type=video" download=""';
					var btntxt='下载';
				}
				var actors=vs[i].actor;
				var actor='';
				for(var j=0;j<actors.length;j++){
					if(j>2)break;
					if(j>0)actor+=' ';
					actor+=actors[j];
				}
				var directors=vs[i].director;
				var director='';
				for(var j=0;j<directors.length;j++){
					if(j>2)break;
					if(j>0)director+=' ';
					director+=directors[j];
				}
				if(sword)vs[i].title=vs[i].title.replace(sword,'<span>'+sword+'</span>');
				var html='<div class="wdj_xwl_sreachlist_one';
				if(i%2==1)html+=' wdj_xwl_sreachlist_one_alt';
				html+=			'">'+
								'<div class="fl"><a href="'+href1+'><img src="http://video.wandoujia.com/api/img/'+vs[i].id+'" /></a></div>'+
								'<div class="auto">'+
									'<h5><a href="'+href1+'><strong>'+vs[i].title+'</strong><em>（2012）</em></a><span>评分：</span><b>'+vs[i].score+'</b></h5>'+
									'<p><strong>主演：</strong><span>'+actor+'</span><strong class="ml15">导演：</strong><span>'+director+'</span></p>'+
									//'<p><strong>类型：</strong><span id="cate'+i+'"></span><strong class="ml15">片长：</strong><span>'+vs[i].time+'</span></p>'+
									'<p><strong>片长：</strong><span>'+vs[i].time+'</span><strong class="ml15">来源：</strong><span id="from'+i+'"></span></p>'+
									'<p class="desc"><strong>简介：</strong><span id="desc'+i+'"></span></p>'+
									'<div class="fix pt3"><a href="'+href2+' class="wdj_xwl_btn2 fl">'+btntxt+'</a></div>'+
								'</div>'+
							'</div>';
				$('#vlist').append(html);
				setinfo(vs[i].id,i,1);
			}
			setPage(page*size+d.next);
		});
	}

	function getVideo2(url){
		$.getJSON(url,function(d){
			var vs=d.items;
			if(vs.length==0){
				$('#wdj_xwl_pages').hide();
				$('.wdj_xwl_wrap_search').css('height','auto').css('minHeight','0');
				$('#vlist').html('<div class="noquery">未到找与「<span>'+$('#vtype').text()+'</span>」匹配的视频</div>');
				return false;
			}
			for(var i in vs){
				var href1='show.html?'+vs[i].id+'"';
				if(vs[i].type=='tv'){
					var href2=href1;
					var btntxt='查看详情';
				}else{
					var href2='http://video.wandoujia.com/api/down/'+vs[i].id+'#&name='+vs[i].title+'.mp4&content-type=video" download=""';
					var btntxt='下载';
				}
				var actors=vs[i].actor;
				var actor='';
				for(var j=0;j<actors.length;j++){
					if(j>2)break;
					if(j>0)actor+=' ';
					actor+=actors[j];
				}
				var directors=vs[i].director;
				var director='';
				for(var j=0;j<directors.length;j++){
					if(j>2)break;
					if(j>0)director+=' ';
					director+=directors[j];
				}
				var cates=vs[i].cate;
				var cate='';
				for(var j=0;j<cates.length;j++){
					if(j>2)break;
					if(j>0)cate+=' ';
					cate+=cates[j];
				}
				if(sword)vs[i].title=vs[i].title.replace(sword,'<span>'+sword+'</span>');
				var html='<div class="wdj_xwl_sreachlist_one';
				if(i%2==1)html+=' wdj_xwl_sreachlist_one_alt';
				html+=			'">'+
								'<div class="fl"><a href="'+href1+'><img src="http://video.wandoujia.com/api/img/'+vs[i].id+'" /></a></div>'+
								'<div class="auto">'+
									'<h5><a href="'+href1+'><strong>'+vs[i].title+'</strong><em>（2012）</em></a><span>评分：</span><b>'+vs[i].score+'</b></h5>'+
									'<p><strong>主演：</strong><span>'+actor+'</span><strong class="ml15">导演：</strong><span>'+director+'</span></p>'+
									//'<p><strong>类型：</strong><span>'+cate+'</span><strong class="ml15">片长：</strong><span>'+vs[i].time+'</span></p>'+
									'<p><strong>片长：</strong><span>'+vs[i].time+'</span><strong class="ml15">来源：</strong><span id="from'+i+'"></span></p>'+
									'<p class="desc"><strong>简介：</strong><span>'+vs[i].info+'</span></p>'+
									'<div class="fix pt3"><a href="'+href2+' class="wdj_xwl_btn2 fl">'+btntxt+'</a></div>'+
								'</div>'+
							'</div>';
				$('#vlist').append(html);
				setinfo(vs[i].id,i);
			}
			setPage(d.total);
		});
	}

	function setinfo(id,n,m){
		$.getJSON('http://video.wandoujia.com/api/detail/'+id+'?jsonp=?',function(d){
			/*
			var cates=d.cate;
			var cate='';
			for(var i=0;i<cates.length;i++){
				if(i>2)break;
				if(i>0)cate+=' ';
				cate+=cates[i];
			}
			$('#cate'+n).html(cate);
			*/
			var from_a={
				'搜狐视频':'http://tv.sohu.com/drama/',
				'乐视':'http://www.letv.com/',
				'PPTV':'http://www.pptv.com/'
			};
			var html='<a href="'+from_a[d.from]+'" target="_default">'+d.from+'</a>';
			$('#from'+n).html(html);
			if(m)$('#desc'+n).html(d.info);
		});
	}

	function setPage(n){
		//alert(n);
		pageurl='?';
		page=parseInt(page);
		for(var i in actions){
			if(i=='page')continue;
			pageurl+=i+'='+actions[i];
		}
		pageurl+='&page=';
		var pages=n%size==0?n/size:Math.floor(n/size)+1;
		var html='';
		for(var i=0;i<pages;i++){
			if(i==0){
				html+='<a href="';
				if(page==1)html+='javascript:;';
				else html+=pageurl+(page-1);
				html+='" class="prev';
				if(page==1)html+=' first';
				html+='">上一页</a><em>・</em>';
			}
			if(i>=page-4&&i<=page+2){
				var j=i+1;
				var url=pageurl+j;
				html+='<a href="'+url+'"';
				if(j==page)html+=' class="on"';
				html+='>'+j+'</a><em>・</em>';
			}
			
			if(i==pages-1){
				html+='<a href="';
				if(page==pages)html+='javascript:;';
				else html+=pageurl+(page+1);
				html+='" class="next';
				if(page==pages)html+=' last';
				html+='">下一页</a>';
			}
		}
		$('#wdj_xwl_pages').html(html);
	}

})();
</script>
<script>var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-15790641-32']);
  _gaq.push(['_trackPageview']);
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
</script>

</body>
</html>
